{
  "name": "Action Items Due Today Banner",
  "description": "Show items due today in the accountability system and use yellow/red banner colors to communicate urgency. Currently, the accountability service excludes items due today (uses > instead of >=), and the banner is always red. Fix the comparison to include due-today items, add urgency metadata to the API response, and update the banner to show yellow for due-today-only or red if any items are overdue.",
  "created": "2026-02-06",
  "ship_project_id": null,
  "task_ids": {},
  "confidence": 90,
  "feedbackLoops": {
    "typeCheck": "pnpm type-check",
    "test": "pnpm test",
    "build": "pnpm build"
  },
  "userStories": [
    {
      "id": "include-due-today",
      "task_id": null,
      "title": "Include due-today items in accountability checks",
      "userStory": "As a team member, I want to see action items that are due today so that I'm reminded to complete them before they become overdue.",
      "context": "The weekly_plan and weekly_retro checks use strict greater-than (>) to compare dates, which means items due today are excluded from the action items list. This is the root cause of the user not seeing their retro due today.",
      "description": "Change the date comparison in checkWeeklyPersonAccountability from > to >= for both weekly_plan and weekly_retro due date checks. Also add has_overdue and has_due_today boolean flags to the API response so the frontend can determine banner urgency.",
      "technicalNotes": "- File: api/src/services/accountability.ts, checkWeeklyPersonAccountability function\n- Line ~390: change `if (todayStr > planDueStr)` to `if (todayStr >= planDueStr)`\n- Line ~418: change `if (todayStr > retroDueStr)` to `if (todayStr >= retroDueStr)`\n- File: api/src/routes/accountability.ts\n- Add `has_overdue` (any item with days_overdue > 0) and `has_due_today` (any item with days_overdue === 0) to response",
      "verification": [
        "API response from /api/accountability/action-items includes has_overdue and has_due_today boolean flags",
        "Items with due_date matching today appear in the response with days_overdue = 0",
        "Items with due_date in the past appear with days_overdue > 0",
        "Items with due_date in the future still do NOT appear (future items should not be shown)"
      ],
      "dependencies": [],
      "priority": "high",
      "passes": true
    },
    {
      "id": "banner-urgency-colors",
      "task_id": null,
      "title": "Banner shows yellow for due-today, red for overdue",
      "userStory": "As a team member, I want the accountability banner to be yellow when I only have items due today and red when I have overdue items, so I can quickly gauge the urgency level.",
      "context": "Currently the banner is always red (bg-red-600), which doesn't distinguish between 'you have something due today' (gentle nudge) and 'you have overdue items' (urgent). Yellow communicates 'attention needed' while red communicates 'action required'.",
      "description": "Update AccountabilityBanner to accept urgency level and render yellow (bg-amber-600) when only due-today items exist, or red (bg-red-600) when any overdue items exist. Update App.tsx to compute and pass the urgency level from action items data.",
      "technicalNotes": "- File: web/src/components/AccountabilityBanner.tsx\n- Add `urgency` prop: 'overdue' | 'due_today'\n- 'overdue' = bg-red-600 (current), 'due_today' = bg-amber-600\n- Badge count: red uses bg-red-800, amber uses bg-amber-800\n- File: web/src/pages/App.tsx\n- Compute urgency from actionItemsData: if any item has days_overdue > 0 â†’ 'overdue', else 'due_today'\n- Pass urgency prop to AccountabilityBanner\n- Also update useActionItemsQuery.ts to include has_overdue/has_due_today in the response type",
      "verification": [
        "When only due-today items exist (days_overdue = 0), banner background is amber/yellow",
        "When any overdue items exist (days_overdue > 0), banner background is red",
        "When mix of due-today and overdue items exist, banner is red (overdue takes priority)",
        "Badge count pill matches banner urgency color (amber-800 or red-800)",
        "Celebration banner (green) still works when items are completed"
      ],
      "dependencies": ["include-due-today"],
      "priority": "high",
      "passes": true
    },
    {
      "id": "e2e-tests",
      "task_id": null,
      "title": "E2E tests for banner urgency colors",
      "userStory": "As a developer, I want E2E tests verifying banner color logic so that future changes don't regress the urgency indicator.",
      "context": "E2E tests ensure the banner color logic works end-to-end with real data, catching issues like the original > vs >= comparison bug.",
      "description": "Write E2E tests in a new file e2e/accountability-banner-urgency.spec.ts that verify: 1) banner appears when action items exist, 2) banner is amber/yellow when only due-today items exist, 3) banner is red when overdue items exist. Use the isolated-env fixture with seed data that creates sprints with known due dates.",
      "technicalNotes": "- Create e2e/accountability-banner-urgency.spec.ts\n- Use test fixture from e2e/fixtures/isolated-env.ts\n- Seed data: create a sprint owned by the test user with a past start_date to trigger accountability\n- Mock the current date or use sprints with known relative dates\n- Test selectors: look for bg-amber-600 or bg-red-600 classes on the banner button\n- The banner is rendered as a <button> with the onClick handler\n- Test that clicking the banner opens the ActionItemsModal",
      "verification": [
        "E2E test file exists at e2e/accountability-banner-urgency.spec.ts",
        "Tests pass when run with pnpm test:e2e e2e/accountability-banner-urgency.spec.ts",
        "Tests verify banner color changes based on item urgency",
        "Tests verify clicking banner opens the action items modal"
      ],
      "dependencies": ["banner-urgency-colors"],
      "priority": "medium",
      "passes": false
    }
  ],
  "postCompletion": {
    "securityReview": false,
    "codeQualityReview": false,
    "testsAdded": false,
    "seedDataChecked": false,
    "fixturesUpdated": false,
    "docsChecked": false,
    "learningsExtracted": false,
    "criticalFindings": []
  }
}
